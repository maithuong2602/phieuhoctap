<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PHIẾU HỌC TẬP SỐ 1 - LƯỢC SỬ CÔNG CỤ TÍNH TOÁN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .bg-gradient-header {
            background-image: linear-gradient(to right, #2563eb, #10b981);
        }
        .text-gradient-header {
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-card {
            background: #fff;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .tab-btn.active {
            background-color: white;
            color: #1f2937;
            border-color: #e5e7eb;
            border-bottom-color: transparent;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Main Content Container -->
    <div class="max-w-4xl mx-auto p-6 lg:p-12">
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <div class="flex-grow">
                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-gradient-header bg-gradient-header">
                    PHIẾU HỌC TẬP SỐ 1
                </h1>
                <p class="text-gray-500 mt-2 text-base">
                    Chủ đề: Lược sử công cụ tính toán · Lớp: 8
                </p>
            </div>
            <div class="flex items-center gap-3">
                <button id="tabPersonal" class="tab-btn active px-4 py-2 rounded-t-lg font-semibold bg-white text-gray-800 border-x border-t border-gray-200 -mb-px">
                    Cá nhân
                </button>
                <button id="tabGroup" class="tab-btn px-4 py-2 rounded-t-lg font-semibold bg-gray-100 text-gray-600 border border-transparent hover:bg-gray-200">
                    Tổng hợp
                </button>
            </div>
        </header>

        <!-- Personal Section -->
        <div id="personalSection" class="bg-white rounded-xl shadow-lg p-6 lg:p-8 border border-gray-200">
            <div class="flex flex-col md:flex-row justify-end gap-3 mb-6">
                <button id="clearBtn" class="px-4 py-2 rounded-lg font-semibold bg-red-600 text-white shadow-md hover:bg-red-700 transition-all">
                    Xóa dữ liệu
                </button>
                <button id="exportPersonalBtn" class="px-4 py-2 rounded-lg font-semibold bg-blue-600 text-white shadow-md hover:bg-blue-700 transition-all">
                    Xuất file
                </button>
            </div>
            <section class="mb-8">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Thông tin thành viên</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label for="member1" class="block text-sm font-medium text-gray-700 mb-1">Họ và tên (Ví dụ: Mai Thương)</label>
                        <input type="text" id="member1" class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500 transition-all p-2" placeholder="Họ và tên">
                    </div>
                </div>
            </section>
            
            <section class="bg-gray-50 rounded-xl p-6 border border-gray-200 mb-8">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Mô tả</h3>
                <p class="text-gray-600 leading-relaxed">
                    Hầu hết mọi người nghĩ về máy tính như một thiết bị điện tử, có khả năng xử lí dữ liệu đa dạng với tốc độ cao và có dung lượng lưu trữ lớn. Em hãy tìm hiểu và trả lời các câu hỏi sau:
                </p>
            </section>
            
            <!-- Phần "Nội dung bài học" đã bị ẩn -->
            <section class="bg-gray-50 rounded-xl p-6 border border-gray-200 mb-8 hidden">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Nội dung bài học</h3>
                <div class="text-gray-700 leading-relaxed space-y-4">
                    <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
                        <img src="https://i.postimg.cc/bvWLCscr/b1h1.png" alt="Hình 1.2. Chiếc máy tính cơ học đầu tiên Pascaline" class="w-full md:w-1/2 rounded-lg" />
                        <div>
                            <strong class="text-lg">Những chiếc bánh răng</strong><br/>
                            <p>Ý tưởng cơ giới hoá việc tính toán đóng vai trò quan trọng trong lịch sử phát triển của máy tính. Năm 1642, nhà bác học người Pháp Blaise Pascal, khi đó chưa đầy 20 tuổi, đã cho ra đời chiếc máy tính cơ học Pascaline để giúp đỡ cha trong việc tính thuế.</p>
                        </div>
                    </div>
                    <p>
                        <strong class="text-lg">Dự án máy tính của Babbage</strong><br/>
                        Sau Pascal, nhà Toán học người Đức Gottfried Leibniz đã cải tiến và thêm phép tính nhân, chia vào máy tính của Pascal để nó thực hiện được cả bốn phép tính số học.<br/>
                        Năm 1833 đánh dấu dự án đầy tham vọng của nhà Toán học, nhà phát minh, kĩ sư cơ khí người Anh Charles Babbage nhằm thiết kế và chế tạo những cỗ máy thực hiện việc tính toán một cách tự động nhằm tránh những sai sót của con người trong việc tính toán và sao chép các con số.<br/>
                        Nguyên lí thiết kế máy tính của Babbage giống như máy tính ngày nay. Đó là loại máy đa năng, thực hiện tính toán tự động và có những ứng dụng ngoài tính toán thuần tuý. Vì vậy, mặc dù dự án của ông không được hoàn thành do hạn chế về công nghệ, ông vẫn được coi là cha đẻ của công nghệ máy tính.
                    </p>
                </div>
            </section>

            <section id="questions" class="flex flex-col gap-6">
                <!-- Questions will be dynamically added here -->
            </section>
        </div>

        <!-- Group Section -->
        <div id="groupSection" class="bg-white rounded-xl shadow-lg p-6 lg:p-8 border border-gray-200 hidden">
            <section class="mb-8">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Thông tin nhóm</h3>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label for="groupName" class="block text-sm font-medium text-gray-700 mb-1">Tên nhóm</label>
                        <input type="text" id="groupName" class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500 transition-all p-2" placeholder="Nhập tên nhóm của bạn">
                    </div>
                    <div>
                        <label for="memberNames" class="block text-sm font-medium text-gray-700 mb-1">Tên thành viên</label>
                        <p id="memberNames" class="w-full rounded-lg border border-gray-300 bg-gray-100 p-2 text-gray-500">
                            Chưa có thành viên nào
                        </p>
                    </div>
                </div>
            </section>
            <section class="bg-white rounded-xl shadow-lg p-6 lg:p-8 border border-gray-200 mt-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
                    <h3 class="text-xl font-semibold text-gray-700">Tổng kết</h3>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <label class="relative cursor-pointer">
                            <input type="file" id="importFilesForSummary" multiple accept="application/json" class="hidden" />
                            <button type="button" id="importSummaryBtn" class="px-4 py-2 rounded-lg font-semibold bg-green-600 text-white shadow-md hover:bg-green-700 transition-all">
                                Tổng hợp từ tệp
                            </button>
                        </label>
                        <button id="exportSummaryBtn" class="px-4 py-2 rounded-lg font-semibold bg-purple-600 text-white shadow-md hover:bg-purple-700 transition-all">
                            Xuất file tổng hợp
                        </button>
                    </div>
                </div>
                <p class="text-gray-500 mb-4 text-sm">Tổng hợp các câu trả lời từ nhiều phiếu học tập khác nhau để tạo một bản tổng kết chung.</p>
                <div id="summaryPointsContainer" class="flex flex-col gap-2 p-4 mb-4 border border-gray-300 rounded-lg bg-gray-50 hidden">
                    <!-- Aggregated points with checkboxes will be added here -->
                </div>
                <textarea id="summary" class="w-full text-sm rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-blue-500 transition-all resize-y min-h-[150px] p-3" placeholder="Gõ bản tổng kết của bạn tại đây hoặc sử dụng chức năng 'Tổng hợp từ tệp' để tự động điền..."></textarea>
            </section>
        </div>
        
        <p class="text-sm text-center text-gray-400 mt-8">
            Dữ liệu được lưu tự động trên trình duyệt.
        </p>
    </div>

    <!-- Custom Modal for Alerts -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-card flex flex-col items-center">
            <p id="modalMessage" class="text-lg text-center mb-6"></p>
            <div class="flex gap-4">
                <button id="modalConfirmBtn" class="px-6 py-2 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700 transition-all">
                    Xác nhận
                </button>
                <button id="modalCloseBtn" class="px-6 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300 transition-all">
                OK
                </button>
            </div>
        </div>
    </div>

    <script>
        const qs = (s) => document.querySelector(s);
        const questions = [
            "Hãy liệt kê ít nhất 3 đồ dùng trong nhà có bộ xử lý? Và cho biết chức năng nào cho biết thiết bị đó có bộ xử lý? Yêu cầu trả lời theo cú pháp: Tủ lạnh – Điều khiển nhiệt độ tự động đảm bảo thực phẩm tươi ngon lâu"
        ];
        const STORAGE_KEY = "phieu_hoc_tap_lich_su_may_tinh_v2";

        const modalOverlay = qs('#modalOverlay');
        const modalMessage = qs('#modalMessage');
        const modalCloseBtn = qs('#modalCloseBtn');
        const modalConfirmBtn = qs('#modalConfirmBtn');
        const summaryTextarea = qs('#summary');
        const summaryPointsContainer = qs('#summaryPointsContainer');
        const personalInfoInput = "member1";
        const groupInfoInput = "groupName";
        const questionInputs = questions.map((q, i) => `q${i + 1}`);
        const allInputs = [personalInfoInput, groupInfoInput, "summary", ...questionInputs];

        let modalCallback = null;
        let aggregatedMemberNames = [];
        let aggregatedAnswersMap = new Map();

        function showMessage(message, confirmCallback = null) {
            modalMessage.textContent = message;
            if (confirmCallback) {
                modalConfirmBtn.style.display = 'inline-block';
                modalCloseBtn.textContent = 'Hủy';
                modalCallback = confirmCallback;
            } else {
                modalConfirmBtn.style.display = 'none';
                modalCloseBtn.textContent = 'OK';
                modalCallback = null;
            }
            modalOverlay.style.display = 'flex';
        }

        modalCloseBtn.addEventListener('click', () => {
            modalOverlay.style.display = 'none';
        });

        modalConfirmBtn.addEventListener('click', () => {
            modalOverlay.style.display = 'none';
            if (modalCallback) {
                modalCallback();
            }
        });

        function renderQuestions() {
            const container = qs('#questions');
            container.innerHTML = '';
            questions.forEach((q, index) => {
                const questionHtml = `
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                        <h4 class="text-md font-semibold text-gray-700 mb-3">
                            Câu ${index + 1}: ${q}
                        </h4>
                        <textarea id="q${index + 1}" class="w-full text-sm rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-blue-500 transition-all resize-y min-h-[100px] p-3" placeholder="Ví dụ: Tủ lạnh – Điều khiển nhiệt độ tự động đảm bảo thực phẩm tươi ngon lâu"></textarea>
                    </div>
                `;
                container.innerHTML += questionHtml;
            });
            loadData();
            addEventListeners();
        }

        function saveData() {
            const data = {
                info: {},
                answers: {},
                summary: summaryTextarea.value
            };
            const personalInfoInputEl = qs(`#${personalInfoInput}`);
            if (personalInfoInputEl) {
                data.info[personalInfoInput] = personalInfoInputEl.value;
            }
            const groupInfoInputEl = qs(`#${groupInfoInput}`);
            if (groupInfoInputEl) {
                data.info[groupInfoInput] = groupInfoInputEl.value;
            }
            questions.forEach((q, index) => {
                const id = `q${index + 1}`;
                data.answers[q] = qs(`#${id}`).value;
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function loadData() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return;
                const data = JSON.parse(raw);
                if (data.info) {
                    const personalInfoInputEl = qs(`#${personalInfoInput}`);
                    if (personalInfoInputEl && data.info[personalInfoInput] !== undefined) {
                        personalInfoInputEl.value = data.info[personalInfoInput];
                    }
                    const groupInfoInputEl = qs(`#${groupInfoInput}`);
                    if (groupInfoInputEl && data.info[groupInfoInput] !== undefined) {
                        groupInfoInputEl.value = data.info[groupInfoInput];
                    }
                }
                if (data.answers) {
                    questions.forEach((q, index) => {
                        const id = `q${index + 1}`;
                        if (data.answers[id] !== undefined) {
                            qs(`#${id}`).value = data.answers[id];
                        }
                    });
                }
                if (data.summary !== undefined) {
                    summaryTextarea.value = data.summary;
                }
            } catch (e) {
                console.warn("Lỗi khi tải dữ liệu:", e);
            }
        }

        function updateSummaryFromCheckboxes() {
            const checkedPoints = [];
            qs('#summaryPointsContainer').querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                checkedPoints.push(checkbox.value);
            });
            summaryTextarea.value = checkedPoints.join('\n');
            saveData();
        }

        function clearData() {
            showMessage('Bạn có chắc chắn muốn xóa toàn bộ dữ liệu trên phiếu học tập không? Thao tác này không thể hoàn tác.', () => {
                allInputs.forEach(id => {
                    const el = qs(`#${id}`);
                    if (el) {
                        el.value = '';
                    }
                });
                summaryPointsContainer.innerHTML = '';
                summaryPointsContainer.classList.add('hidden');
                localStorage.removeItem(STORAGE_KEY);
            });
        }
        
        function addEventListeners() {
            const personalInputEl = qs(`#${personalInfoInput}`);
            personalInputEl.addEventListener('input', (e) => {
                const value = e.target.value.trim();
                const words = value.split(/\s+/);
                if (words.length > 2) {
                    showMessage("Chỉ nhập tên lót + Tên. Ví dụ: Mai Thương.");
                    e.target.value = words.slice(0, 2).join(' ');
                }
                saveData();
            });
            const groupNameInputEl = qs(`#${groupInfoInput}`);
            if (groupNameInputEl) {
                groupNameInputEl.addEventListener('input', (e) => {
                    e.target.value = e.target.value.toUpperCase();
                    saveData();
                });
            }
            questionInputs.forEach(id => {
                const el = qs(`#${id}`);
                if (el) {
                    el.addEventListener('input', saveData);
                }
            });
            qs('#summary').addEventListener('input', saveData);
            
            qs('#clearBtn').addEventListener('click', clearData);
            qs('#exportPersonalBtn').addEventListener('click', exportPersonalData);
            qs('#exportSummaryBtn').addEventListener('click', exportSummary);
            qs('#importFilesForSummary').addEventListener('change', aggregateData);
            qs('#importSummaryBtn').addEventListener('click', () => {
                const importFile = qs('#importFilesForSummary');
                importFile.value = null; // Clear previous selection
                importFile.click();
            });
            summaryPointsContainer.addEventListener('change', updateSummaryFromCheckboxes);

            qs('#tabPersonal').addEventListener('click', () => switchTab('personal'));
            qs('#tabGroup').addEventListener('click', () => switchTab('group'));
        }

        function switchTab(tab) {
            const personalSection = qs('#personalSection');
            const groupSection = qs('#groupSection');
            const tabPersonalBtn = qs('#tabPersonal');
            const tabGroupBtn = qs('#tabGroup');

            if (tab === 'personal') {
                personalSection.classList.remove('hidden');
                groupSection.classList.add('hidden');
                tabPersonalBtn.classList.add('active', 'bg-white', 'border-x', 'border-t', 'border-gray-200', '-mb-px');
                tabPersonalBtn.classList.remove('bg-gray-100', 'text-gray-600', 'border', 'border-transparent');
                tabGroupBtn.classList.remove('active', 'bg-white', 'border-x', 'border-t', 'border-gray-200', '-mb-px');
                tabGroupBtn.classList.add('bg-gray-100', 'text-gray-600', 'border', 'border-transparent');
            } else {
                personalSection.classList.add('hidden');
                groupSection.classList.remove('hidden');
                tabGroupBtn.classList.add('active', 'bg-white', 'border-x', 'border-t', 'border-gray-200', '-mb-px');
                tabGroupBtn.classList.remove('bg-gray-100', 'text-gray-600', 'border', 'border-transparent');
                tabPersonalBtn.classList.remove('active', 'bg-white', 'border-x', 'border-t', 'border-gray-200', '-mb-px');
                tabPersonalBtn.classList.add('bg-gray-100', 'text-gray-600', 'border', 'border-transparent');
            }
        }
        
        function removeDiacritics(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/đ/g, "d").replace(/Đ/g, "D");
        }

        function exportPersonalData() {
            const memberName = qs('#member1').value;
            const emptyAnswers = questionInputs.filter(id => !qs(`#${id}`).value.trim());

            if (!memberName.trim()) {
                showMessage("Vui lòng nhập tên Thành viên để xuất file.");
                return;
            }

            if (emptyAnswers.length > 0) {
                const emptyQuestions = emptyAnswers.map(id => `Câu ${id.replace('q','')}`);
                showMessage(`Bạn chưa trả lời các câu hỏi sau: ${emptyQuestions.join(', ')}. Vui lòng hoàn thành trước khi xuất file.`);
                return;
            }
            
            const fileName = removeDiacritics(memberName).replace(/\s/g, '_');
            const data = {
                info: {
                    memberName: memberName
                },
                answers: {}
            };
            
            questions.forEach((q, index) => {
                const id = `q${index + 1}`;
                data.answers[q] = qs(`#${id}`).value;
            });

            const jsonData = {
                metadata: {
                    title: document.title,
                    exportedBy: memberName,
                    exportedAt: new Date().toISOString()
                },
                data: data
            };
            const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportSummary() {
            const groupName = qs('#groupName').value;
            if (!groupName.trim()) {
                showMessage("Vui lòng nhập Tên nhóm để xuất file tổng hợp.");
                return;
            }
            
            const summaryContent = qs('#summary').value;
            if (!summaryContent.trim()) {
                showMessage("Nội dung tổng kết đang trống. Vui lòng tổng hợp dữ liệu hoặc nhập nội dung trước khi xuất.");
                return;
            }

            const cleanGroupName = removeDiacritics(groupName).replace(/\s/g, '_');
            const cleanMemberNames = aggregatedMemberNames.map(name => removeDiacritics(name).replace(/\s/g, '_')).filter(Boolean).join('_');
            const finalFileName = `${cleanGroupName}_${cleanMemberNames}_PHT1.pdf`;
            
            const content = `
                <div style="font-family: 'Inter', sans-serif; padding: 20px; font-size: 12px; line-height: 1.5;">
                    <h1 style="text-align: center; color: #2563eb; font-size: 24px; font-weight: bold;">File tổng hợp hoạt động 1</h1>
                    <p style="text-align: center; color: #6b7280; font-size: 14px;">Chủ đề: Lược sử công cụ tính toán</p>
                    <hr style="border: 0; height: 1px; background-color: #e5e7eb; margin: 20px 0;">
                    
                    <h2 style="font-size: 16px; font-weight: bold; color: #374151; margin-bottom: 10px;">Thông tin nhóm</h2>
                    <p><strong>Tên nhóm:</strong> ${groupName}</p>
                    <p><strong>Thành viên:</strong> ${aggregatedMemberNames.join(', ')}</p>
                    <br>

                    <h2 style="font-size: 16px; font-weight: bold; color: #374151; margin-bottom: 10px;">Nội dung tổng kết</h2>
                    <pre style="white-space: pre-wrap; font-family: inherit;">${summaryContent}</pre>
                    
                    <br>
                    <p style="color: #6b7280; font-size: 12px; text-align: right;">Được xuất vào: ${new Date().toLocaleString('vi-VN')}</p>
                </div>
            `;
            html2pdf().set({
                margin: 10,
                filename: finalFileName,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).from(content).save();
        }

        function aggregateData(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            aggregatedAnswersMap.clear();
            aggregatedMemberNames = [];
            let filesProcessed = 0;

            for (const file of files) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result).data;
                        const memberName = data.info.memberName || file.name.split('.')[0];
                        if (memberName) {
                            aggregatedMemberNames.push(memberName);
                        }
                        if (data && data.answers) {
                            Object.entries(data.answers).filter(([key, val]) => val.trim() !== '').forEach(([key, answer]) => {
                                const questionText = key;
                                const questionNumber = questions.indexOf(questionText) + 1;
                                if(questionNumber > 0) {
                                    const answerKey = `${questionNumber}-${answer.trim()}`;
                                    if (!aggregatedAnswersMap.has(answerKey)) {
                                        aggregatedAnswersMap.set(answerKey, {
                                            answer: answer.trim(),
                                            label: `Câu ${questionNumber}`,
                                            member: memberName
                                        });
                                    }
                                }
                            });
                        }
                    } catch (error) {
                        console.error(`Lỗi khi đọc tệp ${file.name}:`, error);
                        showMessage(`Lỗi khi đọc tệp ${file.name}`);
                    } finally {
                        filesProcessed++;
                        if (filesProcessed === files.length) {
                            renderAggregatedPoints();
                            updateMemberNamesDisplay();
                        }
                    }
                };
                reader.readAsText(file);
            }
        }
        
        function updateMemberNamesDisplay() {
            const namesListEl = qs('#memberNames');
            if (aggregatedMemberNames.length > 0) {
                namesListEl.textContent = aggregatedMemberNames.join(', ');
            } else {
                namesListEl.textContent = 'Chưa có thành viên nào';
            }
        }

        function renderAggregatedPoints() {
            summaryPointsContainer.innerHTML = '';
            if (aggregatedAnswersMap.size > 0) {
                summaryPointsContainer.classList.remove('hidden');
                const sortedAnswers = [...aggregatedAnswersMap.values()].sort((a, b) => {
                    const qA = parseInt(a.label.match(/\d+/)[0]);
                    const qB = parseInt(b.label.match(/\d+/)[0]);
                    return qA - qB;
                });
                
                let summaryContentHTML = '';
                let currentQuestion = 0;
                
                sortedAnswers.forEach(meta => {
                    const qNumber = parseInt(meta.label.match(/\d+/)[0]);
                    if (qNumber > currentQuestion) {
                        if (currentQuestion > 0) {
                            summaryContentHTML += `<hr class="my-2 border-t border-gray-200">`;
                        }
                        summaryContentHTML += `<h4 class="text-md font-bold mt-2">Câu ${qNumber}:</h4>`;
                        currentQuestion = qNumber;
                    }
                    summaryContentHTML += `<div class="flex items-start gap-2 text-sm text-gray-700 mt-1">
                        <input type="checkbox" value="- ${meta.answer} (${meta.member})" class="mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <span class="flex-1 leading-relaxed"> - ${meta.answer} <span class="font-bold text-gray-500">(${meta.member})</span></span>
                    </div>`;
                });
                summaryPointsContainer.innerHTML = summaryContentHTML;

            } else {
                summaryPointsContainer.classList.add('hidden');
                showMessage('Không tìm thấy câu trả lời nào để tổng hợp.');
            }
        }

        document.addEventListener('DOMContentLoaded', renderQuestions);
    </script>
</body>
</html>
